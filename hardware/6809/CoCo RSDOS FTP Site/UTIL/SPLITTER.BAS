10 'TEXT FILE SPLITTER      March, 199120 '(C) 1991 Arthur J. Flexser30 'This file may be freely distributed40 'on a non-commercial basis.50 '60 'The purpose of this utility is to allow70 'a large text file to be split up into80 'smaller files.  This would allow a90 'downloaded file that is too large to100 'fit into your word processor to be110 'broken down into pieces that will fit.120 '(The maximum file length that can fit into130 'Telewriter-128 is just under 21 grans.)140 '150 'This program is for the CoCo 3 or CoCo 1/2.160 '170 'Caution:  The last line of the input file must terminate with180 'a carriage return, or the program will end abnormally with an190 '?IE ERROR and this last line will not be included in the output file.200 '210 IF PEEK(&HE000)=0 THEN WIDTH 80220 CLEAR 300,&H7C00:CLS:PRINT"TEXT FILE SPLITTER":PRINT230 LINEINPUT"Name of input file: ";F$240 IF PEEK(&HC004)=&HD6 THEN EXEC&HC887(F$):EXEC&HC65F ELSE EXEC&HC935(F$):EXEC&HC68C250 IF PEEK(&H973)=0 THEN PRINT"Can't find that file!":GOTO 230260 IF PEEK(&HC004)=&HD6 THEN EXEC&HC76D ELSE EXEC &HC79D 'FAT to $600270 ID=PEEK(&HEB):NG=1:IG=PEEK(&H976)280 IG=PEEK(&H600+IG):IF IG<&HC0 THEN NG=NG+1:GOTO280 'find file length290 PRINT:PRINT"File ";F$;" is";NG;"grans in length."300 PRINT"How many grans long would you like each"310 INPUT"of the output files to be";G320 IF G>=NG OR G<=0 THEN 290330 LM=2304*G-256:N=1340 PRINT"Select a prefix of up to 7 characters"350 LINEINPUT"to be used for the output filenames: ";P$360 IF LEN(P$)>7 THEN 340370 '380 'Set up non-overlapping 80-track capacity GAT buffers at $7C00 in case user390 'has 40- or 80-track drives.  (CoCo 1/2 users of 40 or 80-track drives will need400 'to put a ROM-to-RAM transfer routine here for these pokes to be effective.)410 '420 IF PEEK(&HC004)=&HD6 THEN POKE&HC72D,&H7C:OT=PEEK(&HC72A):POKE&HC72A,&HA4 ELSE POKE&HC75D,&H7C:OT=PEEK(&HC75A):POKE&HC75A,&HA4430 POKE&H7C00,0:POKE&H7CA4,0:POKE&H7D48,0:POKE&H7DEC,0440 IF PEEK(&HE000)=0 THEN ON BRK GOTO560:ON ERR GOTO540 'CoCo 3 only450 OPEN"I",#1,F$:IF PEEK(&H958)<>&HFF THEN PRINT"Input file is not in ASCII format; can't continue!":GOTO570460 INPUT"Drive number for output files";D:IF D<0 OR D>3 THEN 460470 PRINT:IF FREE(D)<NG THEN PRINT"Insufficient free space on that drive!":GOTO460480 N$=STR$(N):N$=MID$(N$,2):IF N=10 THEN P$=LEFT$(P$,LEN(P$)-1)490 O$=P$+N$+"/TXT:"+CHR$(D+&H30)500 OPEN"O",#2,O$:PRINT"Outputting to file ";O$510 IF EOF(1) THEN CLOSE:PRINT:PRINT"Output finished!":GOTO570520 LINEINPUT#1,A$:OL=OL+LEN(A$)+1530 PRINT#2,A$:IF OL>LM THEN CLOSE#2:OL=0:N=N+1:GOTO480 ELSE 510540 E$="NFSNRGODFCOVOMULBSDD/0IDTMOSLSSTCNFDAODNIOFMNOIEDSUFNEBRDFOBWPFNFSAEFOSEVFER"550 ER$=MID$(E$,2*ERNO+1,2):PRINT#0,"?";ER$;" ERROR IN";ERLIN560 PRINT#0,"Execution aborted."570 CLOSE:POKE&H800+OT*ID,0:IF PEEK(&HC004)=&HD6 THEN POKE&HC72A,OT:POKE&HC72D,8:END ELSE POKE&HC75A,OT:POKE&HC75D,8:END