10 ' SUPER-3 UTIL15 ' FOR THE COCO-320 ' MIKE JORGENSON25 ' COPYRIGHT <C>30 ' JANUARY 198735 '40 CLS:DRIVE0:PCLEAR145 CLEAR7500:VERIFY ON50 POKE113,0:WIDTH40:DIM FL$(68),X$(18),Y$(18),FM(68),GR(68):V$="ON":ON BRK GOTO7055 LOCATE3,3:PRINT"RGB or COMPOSITE monitor:  <R/C> ?":GOSUB580:IFQ$="R"THENPALETTE0,0:PALETTE9,36:PALETTE10,63:PALETTE11,54 ELSEPALETTE9,0:PALETTE10,260 GOSUB610:LOCATE5,7:ATTR2,0:PRINT"Enter <H> at the Command Prompt":PRINT"   to display a HELP MENU screen if":PRINT"   desired.  Make certain your disks":PRINT"   are formatted for 40-TRACKS when":PRINT"   using 40-TRACK system operations."65 LOCATE0,15:GOSUB600:GOTO7570 POKE65496,0:FORX=1TO DF:FL$(X)="":FM(X)=0:GR(X)=0:NEXT75 CLS:CLOSE#1:GOSUB35080 PRINT"<A>  <B>  <C>  <D>  <F>  <H>  <I>":PRINT"   <K>  <L>  <P>  <R>  <S>  <V>  <X>"85 GOSUB580:ON ERR GOTO505:Q=INSTR("CBIKRLPXDSAFHQV",Q$)+1:ONQ GOTO85,105,160,195,225,270,295,310,455,525,620,705,760,820,85090 IFV$="ON"THENV$="OFF":VERIFY OFF ELSEV$="ON":VERIFY ON95 LOCATE3,Y:PRINT"VERIFICATION: "V$:PRINT:FORK=1TO500:NEXT100 LOCATE3,Y:GOTO80105 GOSUB595 ' copy110 LOCATE3,Y:PRINT"COPY WORKING DISK FILE(S): <Y/N> ?":PRINT:GOSUB560:GOSUB535:IF DF=1THENC=1:PRINT:PRINT:GOTO125 ELSEIFA=B THEN120 ELSEPRINT"SUPER COPY or SINGLE FILE: <S/F> ?":PRINT115 Q$=INKEY$:IFQ$="S"THEN140 ELSEIFQ$<>"F"THEN115120 GOSUB385:LINEINPUT"ENTER THE FILE NUMBER TO COPY ?  ";C$:C=VAL(C$):IFC>DF OR C<1THEN100125 IFA<>B THENLOCATE3,Y:PRINT"COPYING:  ";:ATTR3,0:PRINTFL$(C);:ATTR2,0:PRINT"  TO DRIVE"B:COPY""+FL$(C)TO""+FL$(C)+":"+B$:SOUND100,6:GOTO100130 WIDTH32:COPY""+FL$(C):WIDTH40:SOUND100,6:LINEINPUT"   INSERT SOURCE DISK, THEN 'ENTER' ";Q$135 GOTO70140 FORX=1TO DF:LOCATE3,Y:PRINT"COPY:  "FL$(X)" TO"B"  <Y/N> ?"145 Q$=INKEY$:IFQ$="N"THENFL$(X)=""ELSEIFQ$<>"Y"THEN145150 NEXT:FORX=1TO DF:IFFL$(X)=""THEN155 ELSELOCATE3,Y:PRINT"COPYING:  ";:ATTR3,0:PRINTFL$(X);:ATTR2,0:PRINT"  TO DRIVE"B:COPY""+FL$(X)TO""+FL$(X)+":"+B$155 NEXT:GOTO290160 GOSUB595 ' backup165 LOCATE3,Y:PRINT"BACKUP WORKING DRIVE DISK: <Y/N> ?":PRINT170 GOSUB560:GOSUB535:IFA=B THEN100 ELSEPRINT:PRINT:GOSUB215:GOSUB605:LOCATE3,Y:PRINT"BACKING UP:"A"TO"B:PRINT175 TK=0:ON ERR GOTO515180 LOCATE24,Y:PRINT"READING TRK"TK:FOR SC=1TO18:DSKI$ A,TK,SC,X$(SC),Y$(SC):NEXT185 LOCATE24,Y:PRINT"WRITING TRK"TK:FOR SC=1TO18:DSKO$ B,TK,SC,X$(SC),Y$(SC):NEXT:TK=TK+1190 IFTK<=TN THEN180 ELSESOUND100,6:LOCATE3,Z:ATTR2,0,B:LINEINPUT"Backup completed.  Press 'ENTER' ";Q$:ATTR2,0:GOTO100195 LOCATE3,Y:PRINT"REFORMAT INITIALIZED DISK: <Y/N> ?":PRINT:GOSUB560:LOCATE3,Y:PRINT"INITIALIZE ON WHICH DRIVE: <0-3> ?":GOSUB540:GOSUB215:GOSUB605200 LOCATE3,Z:PRINT"Reformating track:":X$=STRING$(128,255):TK=0:VERIFY OFF:ON ERR GOTO515205 LOCATE21,Z:PRINT TK:FOR SC=1TO18:DSKO$ B,TK,SC,X$,X$:NEXT:TK=TK+1:IFTK<=TN THEN205 ELSESOUND100,6:LOCATE11,Z:LINEINPUT" completed, press 'ENTER'";Q$:IFV$="ON"THEN VERIFY ON210 IFA=B THEN70 ELSE100215 LOCATE3,Y:PRINT:LOCATE3,Y:LINEINPUT"NUMBER OF TRACKS:  <ENTER=35> ? ";T$:Z=Y+1:TN=VAL(T$)-1:IFTN<>39THEN TN=34220 RETURN225 GOSUB595 ' kill230 LOCATE3,Y:PRINT"KILL WORKING DISK FILE(S): <Y/N> ?":PRINT:GOSUB560:IF DF=1THENK=1:GOTO245 ELSELOCATE3,Y:PRINT"SUPER KILL or SINGLE FILE: <S/F> ?"235 Q$=INKEY$:IFQ$="S"THEN250 ELSEIFQ$<>"F"THEN235240 GOSUB385:LINEINPUT"ENTER THE FILE NUMBER TO KILL ?  ";K$:K=VAL(K$):IFK>DF OR K<1THEN100245 LOCATE3,Y:PRINT"KILLING:  ";:ATTR3,0:PRINTFL$(K);:ATTR2,0:PRINT"  ON DRIVE"A:KILL""+FL$(K):IF DF>1THEN290 ELSE70250 FORX=1TO DF:LOCATE3,Y:PRINT"KILL:  "FL$(X)"  <YES or NO> ?"255 Q$=INKEY$:IFQ$="N"THENFL$(X)=""ELSEIFQ$<>"Y"THEN255260 NEXT:FORX=1TO DF:IFFL$(X)=""THEN265 ELSELOCATE3,Y:PRINT"KILLING:  ";:ATTR3,0:PRINTFL$(X);:ATTR2,0:PRINT"  ON DRIVE"A:KILL""+FL$(X)265 NEXT:GOTO70270 GOSUB595 ' rename275 LOCATE3,Y:PRINT"RENAME WORKING DISK FILE:  <Y/N> ?":PRINT:GOSUB560:IF DF=1THENN=1 ELSEGOSUB385:LINEINPUT"ENTER A FILE NUMBER TO RENAME ?  ";N$:N=VAL(N$):IFN>DF OR N<1THEN100280 LOCATE3,Y:PRINT"Renaming:  ";:ATTR3,0:PRINTFL$(N);:ATTR2,0:PRINT"  to what ?":PRINT"   <INCLUDE EXT>:   ";:LINEINPUTN$:L=LEN(N$):IFL>12 OR L<1THEN100285 RENAME""+FL$(N)TO""+N$290 SOUND100,6:GOTO70295 GOSUB595 ' load300 LOCATE3,Y:PRINT"LOAD A WORKING DISK FILE:  <Y/N> ?":PRINT:GOSUB560:IF DF=1THENL=1 ELSEGOSUB385:LINEINPUT"ENTER A FILE NUMBER TO LOAD ?  ";L$:L=VAL(L$):IFL>DF OR L<1THEN100305 LOCATE3,Y:PRINT"LOADING:  ";:ATTR3,0:PRINTFL$(L);:ATTR2,0:PRINT"  ON DRIVE"A:FORX=1TO1000:NEXT:WIDTH32:IF FM(L)<>2THENLOAD FL$(L) ELSELOADM FL$(L):END310 GOSUB595 ' printer315 LOCATE3,Y:PRINT"LIST DIRECTORY TO PRINTER: <Y/N> ?":PRINT320 GOSUB560:LOCATE3,Y:PRINT"ENTER A TITLE FOR DISK IN DRIVE:"A325 LINEINPUT"   ";T$:IFT$<>""THEN PRINT#-2:PRINT#-2,T$330 PRINT#-2:FORX=1TO DF STEP2:Y=X+1:PRINT#-2,FL$(X)"  "GR(X);FM(X)"      ";:IFY<=DF THENPRINT#-2,FL$(Y)"  "GR(Y);FM(Y):NEXT335 PRINT#-2,"Free Space ="FR340 SOUND100,6345 GOSUB385:GOTO80350 ON ERR GOTO505 ' dir scan355 DF=0:DSKI$ A,17,2,X$,Y$360 FR=FREE(A):FORX=3TO9:DSKI$ A,17,X,Y$,Z$:FORK=1TO128 STEP32:GOSUB365:NEXTK:Y$=Z$:FORK=1TO128 STEP32:GOSUB365:NEXTK,X:GOTO385365 SB$=MID$(Y$,K,14):L$=LEFT$(SB$,1):IF ASC(SB$)>127 OR L$=CHR$(0)THENRETURN ELSEIFL$=CHR$(255)THEN385 ELSEDF=DF+1370 Y=ASC(RIGHT$(SB$,1))+1:FL$(DF)=LEFT$(SB$,8)+"/"+MID$(SB$,9,3):FM(DF)=ASC(MID$(SB$,12,1))375 GR(DF)=GR(DF)+1:Z=ASC(MID$(X$,Y,1)):IFZ<78THENY=Z+1:GOTO375380 RETURN385 GOSUB610:IF DF>0THEN395390 LOCATE3,6:PRINT"NO FILES PRESENT IN DISK DIRECTORY":SOUND100,6:Y=11:LOCATE3,Y:ATTR2,0:RETURN395 POKE65497,0:T=0400 IF DF<22THENY=4 ELSEY=3405 FORX=1TO DF:IFT=0 AND Y=17THENY=Y-1:FORK=1TO6:PRINT:NEXT410 ATTR2,0:IFT=0THENT=1:Y=Y+1:Z=1 ELSET=0:Z=20415 LOCATE Z,Y:IFX>9THENPRINT X; ELSEPRINT X" ";420 ATTR3,0:PRINTFL$(X);GR(X)425 NEXT:ATTR2,0:IFT=0THENY=Y+1:Z=5 ELSEZ=24430 LOCATE Z,Y:PRINT"Free =";435 ATTR2,0,B:PRINT FR:ATTR2,0440 IF DF<22THENY=Y+3 ELSEY=Y+2445 LOCATE3,Y:POKE65496,0450 RETURN455 IF DF<2THEN85 ' dir sort460 LOCATE3,Y:PRINT"SORT THE DISK DIRECTORY:  <Y/N> ?":PRINT:GOSUB560:LOCATE3,Y+1:PRINT"Ok, a moment please:  NOW SORTING."465 FL=0:FORX=3TO18:DSKI$ A,17,X,Y$,Z$:X$=Y$:GOSUB470:X$=Z$:GOSUB470:NEXTX:GOTO480470 FORK=1TO128 STEP32:FL=FL+1:FL$(FL)=MID$(X$,K,32):Q=ASC(LEFT$(FL$(FL),1)):IFQ=0THENFL=FL-1 ELSEIFQ=255THENFL=FL-1:GOTO480475 NEXTK:RETURN480 Z=0:POKE65497,0485 K=0:FORX=1TO FL490 Y=X+1:IF LEFT$(FL$(X),11)>LEFT$(FL$(Y),11)THENZ=1:K=1:X$=FL$(X):FL$(X)=FL$(Y):FL$(Y)=X$495 NEXT:IFK=1THEN485 ELSEIFZ=0THEN290 ELSEPOKE65496,0:SC=3:X=0500 Y$="":Z$="":FORK=1TO4:GOSUB590:Y$=Y$+FL$(X+K):NEXT:FORK=5TO8:GOSUB590:Z$=Z$+FL$(X+K):NEXT:DSKO$ A,17,SC,Y$,Z$:SC=SC+1:X=X+8:IFX<FL THEN500 ELSE290505 GOSUB520:LINEINPUT"FUNCTION ERROR:  press 'ENTER' key ";Q$510 GOTO70515 GOSUB520:PRINT"SYSTEM ERROR:  Track"TK"/ Sector"SC;:LINEINPUTQ$:GOTO345520 CLS:SOUND100,6:LOCATE2,3:ATTR2,0,B:RETURN525 LOCATE3,Y:PRINT"CHANGE THE WORKING DRIVE:  <Y/N> ?":PRINT:GOSUB560:LOCATE3,Y+1:PRINT"To Which Drive:  0/3   ";:ATTR2,0,B:PRINT"<ENTER=0> ?":ATTR2,0530 GOSUB580:A=VAL(Q$):IFA>3THEN530 ELSEDRIVE A:GOTO70535 LOCATE3,Y:PRINT"The SOURCE drive is:"A"    What is":PRINT"   the DESTINATION drive: ";:ATTR2,0,B:PRINT"<ENTER=0> ?":ATTR2,0540 B$=INKEY$:IFB$=""THEN540545 B=VAL(B$):IFB>3THEN100550 IFB<1THENB$="0"555 LOCATE3,Y:RETURN560 Q$=INKEY$:IFQ$=""THEN560565 IFQ$="Y"THENRETURN ELSE100570 Q$=INKEY$:IFQ$=""THEN570575 IFQ$="Y"THENRETURN ELSE345580 Q$=INKEY$:IFQ$=""THEN580585 RETURN590 IFFL$(X+K)=""THENFL$(X+K)=STRING$(32,255):RETURN ELSERETURN595 IF DF<1THEN85 ELSERETURN600 LINEINPUT"   Press <ENTER> when ready ... ";Q$:RETURN605 LINEINPUT"   When ready to begin, hit 'ENTER' ";Q$:RETURN610 CLS:LOCATE9,1:ATTR1,0,B615 PRINT"<<<  SUPER-3 UTIL  >>>":ATTR3,0:RETURN620 LOCATE3,Y:PRINT"SCAN THE DISK ON DRIVE:"A" <Y/N> ?":PRINT:GOSUB560:GOSUB215:ON ERR GOTO515625 LOCATE3,Y:PRINT"DISK SCAN or VERIFICATION: <S/V> ?"630 Q$=INKEY$:IFQ$="S"THEN650 ELSEIFQ$<>"V"THEN630635 TK=0:PRINT"   VERIFYING TRACK: 0    SECTOR:"640 LOCATE19,Z:PRINT TK;:FOR SC=1TO18:LOCATE32,Z:PRINT SC:DSKI$ A,TK,SC,X$,Y$:NEXT:TK=TK+1:IFTK<=TN THEN640 ELSESOUND100,6645 LOCATE3,Z:ATTR2,0,B:LINEINPUT"Disk format intact, press 'ENTER'";Q$:ATTR2,0:GOTO100650 LINEINPUT"   START AT WHICH TRACK:  <0-39> ? ";X$:T=VAL(X$):LOCATE3,Z:PRINT:IFT>TN THENT=0655 LOCATE3,Z:LINEINPUT"START AT WHICH SECTOR: <1-18> ? ";X$:S=VAL(X$):IFS<1 OR S>18THENS=1660 CLS:LOCATE9,1:ATTR1,0,B:PRINT"<<<  SUPER-3 SCAN  >>>"665 LOCATE3,9:FOR TK=T TO TN:FOR SC=S TO18:DSKI$ A,TK,SC,Y$,Z$:ATTR3,0:PRINT:PRINT670 PRINT"   "Y$;Z$:ATTR2,0675 PRINT:PRINT:PRINT"   SCANNING TRACK:"TK"  SECTOR:"SC680 Q$=INKEY$:IFQ$=""THEN695685 Q$=INKEY$:IFQ$=""THEN685690 IFQ$=CHR$(13)THEN345695 NEXT SC:S=1:NEXT TK700 SOUND100,6:ATTR3,0,B:PRINT:PRINT:GOSUB600:GOTO345705 GOSUB595 ' ascii710 LOCATE3,Y:PRINT"REVIEW AN ASCII TEXTFILE:  <Y/N> ?":PRINT:GOSUB560:IF DF=1THENL=1 ELSEGOSUB385:LINEINPUT"ENTER AN ASCII FILE TO SCAN ?  ";L$:L=VAL(L$):IFL>DF OR L<1OR FM(L)<>1THEN100715 CLS:LOCATE7,1:ATTR1,0,B:PRINT"<<<  ASCII FILE SCAN  >>>":ATTR2,0:ON ERR GOTO750720 LOCATE0,6:OPEN"I",#1,FL$(L)725 X=EOF(1):IFX= -1THEN755730 LINEINPUT#1,L$:PRINT" "L$735 Q$=INKEY$:IFQ$=""THEN725740 Q$=INKEY$:IFQ$=""THEN740745 IFQ$<>CHR$(13)THEN725750 CLOSE#1:GOTO345755 CLOSE#1:GOTO700760 GOSUB595:GOSUB610:LOCATE3,7:PRINT"1. Save the directory to GRAN 68.":PRINT:PRINT"   2. Restore directory from GRAN 68.":PRINT:PRINT"   3. ABORT / return to command menu."765 LOCATE6,15:ATTR2,0:PRINT"ENTER YOUR CHOICE:  <1/3> ?":GOSUB580:ON VAL(Q$)GOTO775,810770 GOTO345775 LOCATE3,15:PRINT:LOCATE3,15:LINEINPUT"Enter date: <MTH/DA/YR>  ";DT$:L=LEN(DT$)780 IFL<1 OR L>9THEN345785 DSKI$ A,17,2,X$,Y$:Q$=MID$(X$,68,1):IFQ$=CHR$(249)ORQ$=CHR$(255)THEN795 ELSELOCATE3,17790 ATTR3,0,B:PRINT"DATA PRESENT ON GRAN 68.";:ATTR2,0:PRINT"  Continue":PRINT"   with the saving procedure: <Y/N> ?":GOSUB570795 MID$(X$,68,1)=CHR$(249)800 DSKO$ A,17,2,X$,Y$805 FOR SC=1TO9:DSKI$ A,17,SC,X$(SC),Y$(SC):NEXT:MID$(Y$(9),119,L)=DT$:FOR SC=1TO9:DSKO$ A,34,SC+9,X$(SC),Y$(SC):NEXT:GOTO290810 DSKI$ A,34,18,X$,Y$:DT$=MID$(Y$,119,9):LOCATE3,15:PRINT"THE LAST ENTRY DATE IS:  "DT$:PRINT"   continue with restoration: <Y/N> ?":GOSUB570:FOR SC=1TO9815 DSKI$ A,34,SC+9,X$(SC),Y$(SC):NEXT:FOR SC=1TO9:DSKO$ A,17,SC,X$(SC),Y$(SC):NEXT:GOTO290820 CLS:LOCATE9,1 ' help menu825 ATTR1,0,B:PRINT"<<<  SUPER-3 MENU  >>>":LOCATE3,4:ATTR2,0830 PRINT"<A> = List an ASCII data file.":PRINT"   <B> = Backup to another disk.":PRINT"   <C> = Copy any / all disk files.":PRINT"   <D> = Change working disk drive.":PRINT"   <F> = Save / load FAT on GRAN68."835 PRINT"   <H> = Display help menu screen.":PRINT"   <I> = Reinitialize formated disk.":PRINT"   <K> = Kill any / all disk files.":PRINT"   <L> = Load / loadM any disk file.":PRINT"   <P> = List directory to printer."840 PRINT"   <Q> = Quit / exit this utility.":PRINT"   <R> = Rename any file on disk.":PRINT"   <S> = Scan disk or verification.":PRINT"   <V> = Toggle verify:  on / off.":PRINT"   <X> = Sort the working disk DIR."845 PRINT:PRINT"   <BREAK> = Read in another disk.":GOTO700850 LOCATE3,Y:PRINT"QUIT / EXIT TO DISK BASIC: <Y/N> ?":PRINT:GOSUB560:EXEC40999