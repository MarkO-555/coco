<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=us-ascii">
<TITLE>H:\NANIOS~2\OS-9LE~3\BASIC09\BASIC~27\Basic09 - Appendix B.htm</TITLE>
<META NAME="GENERATOR" CONTENT="ADOBE SYSTEMS, INC. - WORD FOR WORD">
</HEAD>

<BODY>
<BASEFONT SIZE="3">
<FONT SIZE="4" FACE="Times Roman" COLOR="#000000">
Appendix B<BR>
</FONT>
<FONT SIZE="4" FACE="Times Roman" COLOR="#000000">
<BR>
<H2 ALIGN="LEFT">
</FONT>
<FONT SIZE="6" FACE="Times Roman" COLOR="#000000">
The Inkey Program
</FONT>
</H2>
<H2 ALIGN="LEFT">
<FONT SIZE="6" FACE="Times Roman" COLOR="#000000">
<IMG SRC="file:///H:\NANIOS~2\OS-9LE~3\BASIC09\BASIC~27\GR000000.JPG" WIDTH="10" HEIGHT="6">
<H2 ALIGN="LEFT">
<IMG SRC="file:///H:\NANIOS~2\OS-9LE~3\BASIC09\BASIC~27\GR000001.JPG" WIDTH="19" HEIGHT="3">
<H2 ALIGN="LEFT">
<IMG SRC="file:///H:\NANIOS~2\OS-9LE~3\BASIC09\BASIC~27\GR000002.JPG" WIDTH="19" HEIGHT="3">
<H2 ALIGN="LEFT">
<IMG SRC="file:///H:\NANIOS~2\OS-9LE~3\BASIC09\BASIC~27\GR000003.JPG" WIDTH="10" HEIGHT="5">
</FONT>
</H2>
<FONT SIZE="5" FACE="Times Roman" COLOR="#000000">
Assembly Language Listing of Inkey<BR>
<BR>
</FONT>
<FONT SIZE="3" FACE="Times Roman" COLOR="#000000">
An assembled version of Inkey is included on the CONFIG/
BASIC09 diskette. Use Inkey from BASIC09 with the RUN
statement.<BR>
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
~ INKEY - a subroutine for BASIC09 by Robert Doggett<BR>
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
~ Called by; RUN INKEY(StrVar)<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
RUN INKEY(Path,StrVar)
~ INKEY determines if a key has been typed on the given path
~ (Standard Input if not specified), and if so, returns the next
~ character in the String Variable. If no key has been typed, the
~ null string is returned, If a path 
</FONT>
<FONT SIZE="1" FACE="Times Roman" COLOR="#000000">
i5 
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
Specified, it must be
~ either type BYTE or INTEGER.<BR>
<BR>
<UL>
<UL>
<UL>
<UL>
<UL>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
NAM INKEY
</UL>
</UL>
</UL>
</UL>
</UL>
<BR>
<UL>
<UL>
<UL>
<UL>
<UL>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
IFP1
</UL>
</UL>
</UL>
</UL>
</UL>
<BR>
<UL>
<UL>
<UL>
<UL>
<UL>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>USE /D0/DEFS/OS9DEFS
</UL>
</UL>
</UL>
</UL>
</UL>
<BR>
<UL>
<UL>
<UL>
<UL>
<UL>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>ENDC
</UL>
</UL>
</UL>
</UL>
</UL>
<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0021 TYPE<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0081 REVS<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0000 87CDOOSE<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<BR>
<P ALIGN="JUSTIFY">
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>OOOD 496E6H65
D 0000
D 0000
D 0002
D 0004
D 0006
D 0008
D 000A</B>
</FONT>
</P>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>000C<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>000E<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0012 3064<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>Set SHRTN+OBJCT<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>Set REENT+1<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<BR>
<P ALIGN="JUSTIFY">
<UL>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>InKeyNam </B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
fc5
org
</UL>
</FONT>
</P>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
Return rmb<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
PCount rmb<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
Param1 rmb<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
Length1 rmb<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
Param2 rmb<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
Length2 rmb<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
E3Param e9u<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
SIZE equ<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
InKeyEnt leax<BR>
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
mod InKeyEnd,InKeyNam,TYPE,REVS<BR>
 
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
,InKeyEnt,SIZE<BR>
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
"Inkey"<BR>
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
0<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
2<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
2<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
2<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
2<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
2<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
2<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
$38<BR>
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
Paraml,S<BR>
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
Parameters
Return addr of caller
Num of params following
1st param addr
Size
2nd param addr
size<BR>
<IMG SRC="file:///H:\NANIOS~2\OS-9LE~3\BASIC09\BASIC~27\GR000004.JPG" WIDTH="22" HEIGHT="9">
</FONT>
<FONT SIZE="3" FACE="Times Roman" COLOR="#000000">
<I>BASIC09 Commands Reference<BR>
</I>
</FONT>
<FONT SIZE="3" FACE="Times Roman" COLOR="#000000">
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
0014 EC62 ldd Pcount,S Get parameter count<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0016 10830001 </B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
cmpd x1 just one parameter?<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
001A 2727 beq InKey20 <B>_Yes; default path A=0<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
<B>001C 10830002 </B>cmpd x2 Are there two param5?<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0020 2635 bne ParamErr No, <B>abort<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
<B>0022 ECF804 </B>ldd fParam1,S] Get path number<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
0025 AE66  ldx Lengthl,S<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
0027 301E  leax -1,X byte variable?<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
0029 2706  beq InKey10 
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
<B>_Yes; (A)=Path number<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
<B>002E 301E  leax </B>-1,X Integer?<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
002D 2628  bne ParamErr _ No; abort<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
002E 1F98  tfr <B>H,A<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
<B>0031 3068 InKey10 </B>leax Param2,S<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0033 EE02 InKey20 ldu 2,X length of string<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0035 AE84  ldx O,X addr of string<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0037 C6FF  ldb xsFF<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0039 E784  stb </B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
O,X Initialize to null <B>str<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
<B>0038 11830002  </B>cmpu #2 at least two-byte str?<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
003E 2502  blo InKey30 _ No<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0041 E701  5tb 1,X put str terminator<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0043 C601 InKey30 ldb #SS,Ready<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0045 103FBD  OS9 I$GetStt i5 there any data ready?<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0048 2508  bcs </B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
InKey90 _ No; <B>exit<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
<B>004A 108E0001  </B>ldy x1<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>004E 103F89  </B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
OS9 I$Read Read one byte<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0051 39  rt5  returns error status<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0052 C1F6 InKey90 cmpb <B>xE$NotRdy<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
<B>0054 2603  bne InKeyErr<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0056 39 </B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
its  (carry clear)<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
0057 C638 ParamErr ldb xESParam Parameter Error<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0059 43 InKeyErr coma<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>005A 39 its<BR>
</B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
<B>0058 1A6916 </B>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
emod<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow1" COLOR="#000000">
005E InKeyEnd equ<BR>
<BR>
</FONT>
<FONT SIZE="1" FACE="Arial Narrow" COLOR="#000000">
B-2<BR>
<IMG SRC="file:///H:\NANIOS~2\OS-9LE~3\BASIC09\BASIC~27\GR000005.JPG" WIDTH="24" HEIGHT="7">
<IMG SRC="file:///H:\NANIOS~2\OS-9LE~3\BASIC09\BASIC~27\GR000006.JPG" WIDTH="22" HEIGHT="5">
</FONT>
</BODY>
</HTML>
